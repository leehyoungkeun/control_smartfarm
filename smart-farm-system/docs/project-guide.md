# ìŠ¤ë§ˆíŠ¸íŒœ ì–‘ì•¡ ê´€ìˆ˜ ì›ê²©ì œì–´ ì‹œìŠ¤í…œ - í”„ë¡œì íŠ¸ ê°€ì´ë“œ

> ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ì— ì²˜ìŒ ì°¸ì—¬í•˜ëŠ” ê°œë°œìë¥¼ ìœ„í•œ ì•ˆë‚´ì„œì…ë‹ˆë‹¤.
> ì „ì²´ êµ¬ì¡°ë¥¼ í° ê·¸ë¦¼ë¶€í„° ì„¸ë¶€ íŒŒì¼ê¹Œì§€ ë‹¨ê³„ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ëª©ì°¨

1. [ì´ ì‹œìŠ¤í…œì€ ë¬´ì—‡ì¸ê°€?](#1-ì´-ì‹œìŠ¤í…œì€-ë¬´ì—‡ì¸ê°€)
2. [ì „ì²´ êµ¬ì¡° í•œëˆˆì— ë³´ê¸°](#2-ì „ì²´-êµ¬ì¡°-í•œëˆˆì—-ë³´ê¸°)
3. [ë°ì´í„°ê°€ íë¥´ëŠ” ê¸¸](#3-ë°ì´í„°ê°€-íë¥´ëŠ”-ê¸¸)
4. [í´ë”ë³„ ìƒì„¸ ì„¤ëª…](#4-í´ë”ë³„-ìƒì„¸-ì„¤ëª…)
5. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°](#5-ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¡°)
6. [í™”ë©´(í˜ì´ì§€) êµ¬ì„±](#6-í™”ë©´í˜ì´ì§€-êµ¬ì„±)
7. [MQTT í†µì‹  ê·œì¹™](#7-mqtt-í†µì‹ -ê·œì¹™)
8. [Node-REDê°€ í•˜ëŠ” ì¼](#8-node-redê°€-í•˜ëŠ”-ì¼)
9. [ê°œë°œ í™˜ê²½ ì‹¤í–‰ ë°©ë²•](#9-ê°œë°œ-í™˜ê²½-ì‹¤í–‰-ë°©ë²•)
10. [ë°°í¬ ë°©ë²•](#10-ë°°í¬-ë°©ë²•)
11. [íŒŒì¼ ëª©ë¡ ì „ì²´](#11-íŒŒì¼-ëª©ë¡-ì „ì²´)

---

## 1. ì´ ì‹œìŠ¤í…œì€ ë¬´ì—‡ì¸ê°€?

### í•œ ì¤„ ìš”ì•½
**ë¹„ë‹í•˜ìš°ìŠ¤ ì•ˆì˜ ì‹ë¬¼ì— ì–‘ì•¡(ì˜ì–‘ë¶„ì´ ë“  ë¬¼)ì„ ìë™ìœ¼ë¡œ ì£¼ëŠ” ì‹œìŠ¤í…œì„ ì›ê²©ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤.

### ëˆ„ê°€ ì“°ë‚˜?
- **ë†ì¥ í˜„ì¥ ì‘ì—…ì**: ë¹„ë‹í•˜ìš°ìŠ¤ ì•ˆì— ì„¤ì¹˜ëœ 7ì¸ì¹˜ í„°ì¹˜ íŒ¨ë„ì„ í„°ì¹˜í•´ì„œ ê´€ìˆ˜(ë¬¼ì£¼ê¸°)ë¥¼ ì œì–´
- **ì‚¬ë¬´ì‹¤ ê´€ë¦¬ì**: ì‚¬ë¬´ì‹¤ PCë‚˜ ë…¸íŠ¸ë¶ì—ì„œ ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì—´ì–´ ì—¬ëŸ¬ ë†ì¥ì„ í•œêº¼ë²ˆì— ëª¨ë‹ˆí„°ë§
- **ì‹œìŠ¤í…œ ê´€ë¦¬ì**: ì‚¬ìš©ì ê³„ì •, ë†ì¥ ë“±ë¡, ê²½ë³´ ê´€ë¦¬ ë“± ì „ì²´ ì‹œìŠ¤í…œì„ ê´€ë¦¬

### í•µì‹¬ ê¸°ëŠ¥
| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ | EC(ì „ê¸°ì „ë„ë„), pH, ì˜¨ë„, ì¼ì‚¬ëŸ‰, ìœ ëŸ‰ ë“± ì„¼ì„œ ê°’ì„ ì‹¤ì‹œê°„ í™•ì¸ |
| ìë™ ê´€ìˆ˜ | ì¼ì‚¬ëŸ‰/ì‹œê°„ê°„ê²©/ê³ ì •ì‹œê°„ ê¸°ë°˜ìœ¼ë¡œ ë°¸ë¸Œë¥¼ ìë™ìœ¼ë¡œ ì—´ê³  ë‹«ìŒ |
| ìˆ˜ë™ ì œì–´ | 14ê°œ ë°¸ë¸Œ, íŒí”„, êµë°˜ê¸°ë¥¼ ê°œë³„ì ìœ¼ë¡œ ON/OFF |
| ê²½ë³´ | ì„¼ì„œ ê°’ì´ ì„¤ì • ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©´ ì¦‰ì‹œ ì•Œë¦¼ |
| ë¹„ìƒì •ì§€ | ê¸´ê¸‰ ìƒí™© ì‹œ ëª¨ë“  ì¥ë¹„ë¥¼ ì¦‰ì‹œ ì •ì§€ |
| ì¼ì¼ ì§‘ê³„ | í•˜ë£¨ ë™ì•ˆì˜ ê´€ìˆ˜ ì‹¤ì ì„ ìë™ìœ¼ë¡œ ê¸°ë¡ |

### ê·œëª¨
- ìµœëŒ€ **1,000ê°œ ë†ì¥**ì„ í•˜ë‚˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ ê´€ë¦¬
- ê° ë†ì¥ì—ëŠ” **14ê°œ ë°¸ë¸Œ**, **6ê°œ ê´€ìˆ˜ í”„ë¡œê·¸ë¨**, **7ê°œ ì–‘ì•¡ íƒ±í¬**

---

## 2. ì „ì²´ êµ¬ì¡° í•œëˆˆì— ë³´ê¸°

### ë¬¼ë¦¬ì  êµ¬ì„±

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚      ë†ì¥ í˜„ì¥ (ë¹„ë‹í•˜ìš°ìŠ¤)       â”‚
  â”‚                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  7ì¸ì¹˜ í„°ì¹˜íŒ¨ë„       â”‚  â”‚  â† ì‘ì—…ìê°€ ì§ì ‘ í„°ì¹˜
  â”‚  â”‚  (ì›¹ ë¸Œë¼ìš°ì €)        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚           â”‚ localhost     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  ë¼ì¦ˆë² ë¦¬íŒŒì´ (RPi)   â”‚  â”‚  â† ì†Œí˜• ì»´í“¨í„°. ì„¼ì„œë¥¼ ì½ê³  ë°¸ë¸Œë¥¼ ì œì–´
  â”‚  â”‚  - rpi-server      â”‚  â”‚
  â”‚  â”‚  - Node-RED        â”‚  â”‚
  â”‚  â”‚  - SQLite DB       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ì¸í„°ë„· (MQTT)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  AWS IoT Core      â”‚  â”‚  â† í´ë¼ìš°ë“œ ë©”ì‹œì§€ ì¤‘ê³„ì†Œ (MQTT ë¸Œë¡œì»¤)
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ì¸í„°ë„· (MQTT)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚      ì‚¬ë¬´ì‹¤ ì„œë²„           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  cloud-server      â”‚  â”‚  â† Express API + PostgreSQL
  â”‚  â”‚  + frontend(Nginx) â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚           â”‚ ì›¹ë¸Œë¼ìš°ì €      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  ê´€ë¦¬ì PC/ë…¸íŠ¸ë¶     â”‚  â”‚  â† ì‚¬ë¬´ì‹¤ì—ì„œ ì›ê²© ëª¨ë‹ˆí„°ë§
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„± (ì´ í”„ë¡œì íŠ¸ì˜ í´ë”ë“¤)

```
smart-farm-system/
â”‚
â”œâ”€â”€ cloud-server/    â† ë°±ì—”ë“œ 1: ì‚¬ë¬´ì‹¤ ì„œë²„ (Node.js + Express + PostgreSQL)
â”‚                       ëª¨ë“  ë†ì¥ì˜ ë°ì´í„°ë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬
â”‚
â”œâ”€â”€ rpi-server/      â† ë°±ì—”ë“œ 2: ë¼ì¦ˆë² ë¦¬íŒŒì´ ì„œë²„ (Node.js + Express + SQLite)
â”‚                       ê° ë†ì¥ì— 1ëŒ€ì”©. ì„¼ì„œ/ë°¸ë¸Œë¥¼ ì§ì ‘ ì œì–´
â”‚
â”œâ”€â”€ frontend/        â† í”„ë¡ íŠ¸ì—”ë“œ: í™”ë©´ (React + MUI)
â”‚                       í„°ì¹˜íŒ¨ë„ê³¼ ì‚¬ë¬´ì‹¤ PCì—ì„œ ê°™ì€ ì½”ë“œë¥¼ ê³µìœ 
â”‚
â”œâ”€â”€ shared/          â† ë°±ì—”ë“œ 1, 2ê°€ ê³µí†µìœ¼ë¡œ ì“°ëŠ” ìƒìˆ˜ì™€ MQTT í† í”½ ì •ì˜
â”‚
â”œâ”€â”€ node-red/        â† ì„¼ì„œ ì½ê¸° + ê´€ìˆ˜ ìë™í™” ì—”ì§„ (RPiì—ì„œ ì‹¤í–‰)
â”‚
â”œâ”€â”€ docker/          â† ì‚¬ë¬´ì‹¤ ì„œë²„ ë°°í¬ ì„¤ì • (Docker)
â”‚
â”œâ”€â”€ scripts/         â† RPi ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ (PM2)
â”‚
â””â”€â”€ docs/            â† ë¬¸ì„œ (AWS IoT ì„¤ì • ê°€ì´ë“œ, ì´ ë¬¸ì„œ)
```

---

## 3. ë°ì´í„°ê°€ íë¥´ëŠ” ê¸¸

### ì‹œë‚˜ë¦¬ì˜¤ 1: í„°ì¹˜íŒ¨ë„ì—ì„œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

```
ì„¼ì„œ â†’ Node-RED(2ì´ˆë§ˆë‹¤ ì½ê¸°)
         â”‚
         â–¼
    POST /internal/sensor-update
         â”‚
         â–¼
    RPi Express ì„œë²„
    â”œâ”€â”€ SQLiteì— ì €ì¥
    â”œâ”€â”€ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸
    â””â”€â”€ WebSocketìœ¼ë¡œ í„°ì¹˜íŒ¨ë„ì— ì „ì†¡ (1ì´ˆë§ˆë‹¤)
         â”‚
         â–¼
    í„°ì¹˜íŒ¨ë„ í™”ë©´ì— í‘œì‹œ
```

**í•µì‹¬**: í„°ì¹˜íŒ¨ë„ì€ ê°™ì€ ë¼ì¦ˆë² ë¦¬íŒŒì´ ì•ˆì—ì„œ localhostë¡œ í†µì‹ í•©ë‹ˆë‹¤. ì¸í„°ë„·ì´ ëŠê²¨ë„ ì‘ë™í•©ë‹ˆë‹¤.

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì‚¬ë¬´ì‹¤ì—ì„œ ì›ê²© ëª¨ë‹ˆí„°ë§

```
ê´€ë¦¬ìê°€ ì›¹ë¸Œë¼ìš°ì €ì—ì„œ ë†ì¥ ì„ íƒ
         â”‚
         â–¼
    Frontend â†’ WebSocket ì—°ê²° â†’ Cloud Server
         â”‚
         â–¼
    Cloud Serverê°€ MQTTë¡œ "ë°ì´í„° ë³´ë‚´ì¤˜" ìš”ì²­
    (farm/{farmId}/request/start)
         â”‚
         â–¼
    AWS IoT Core (ë©”ì‹œì§€ ì¤‘ê³„)
         â”‚
         â–¼
    RPiê°€ ìš”ì²­ ìˆ˜ì‹  â†’ 3ì´ˆë§ˆë‹¤ ì„¼ì„œ ë°ì´í„° MQTT ë°œí–‰
    (farm/{farmId}/telemetry)
         â”‚
         â–¼
    AWS IoT Core â†’ Cloud Server ìˆ˜ì‹ 
         â”‚
         â–¼
    Cloud Server â†’ WebSocketìœ¼ë¡œ ê´€ë¦¬ì ë¸Œë¼ìš°ì €ì— ì „ë‹¬
         â”‚
         â–¼
    í™”ë©´ì— í‘œì‹œ

    â€» ê´€ë¦¬ìê°€ ë¸Œë¼ìš°ì €ë¥¼ ë‹«ìœ¼ë©´ â†’ request/stop â†’ RPiê°€ ë°œí–‰ ì¤‘ë‹¨
```

**í•µì‹¬**: RPiëŠ” ëˆ„êµ°ê°€ ë³´ê³  ìˆì„ ë•Œë§Œ ì„¼ì„œ ë°ì´í„°ë¥¼ í´ë¼ìš°ë“œë¡œ ë³´ëƒ…ë‹ˆë‹¤. ì•„ë¬´ë„ ì•ˆ ë³´ë©´ ì•ˆ ë³´ëƒ…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•´ì•¼ AWS ë¹„ìš©ì´ ì ˆì•½ë©ë‹ˆë‹¤.

### ì‹œë‚˜ë¦¬ì˜¤ 3: ìë™ ê´€ìˆ˜

```
Node-RED ìŠ¤ì¼€ì¤„ëŸ¬ (10ì´ˆë§ˆë‹¤ í™•ì¸)
         â”‚
    í”„ë¡œê·¸ë¨ ì„¤ì • ì¡°íšŒ (GET /internal/programs)
         â”‚
    íŠ¸ë¦¬ê±° ì¡°ê±´ ì¶©ì¡±? (ì¼ì‚¬ëŸ‰ â‰¥ ì„¤ì •ê°’?)
         â”‚ YES
         â–¼
    ê´€ìˆ˜ ì‹œí€€ìŠ¤ ì‹œì‘ (5ë‹¨ê³„)
    â‘   ì›ìˆ˜ íŒí”„ ON
    â‘¡  ì–‘ì•¡ í˜¼í•© (êµë°˜ê¸° ON, ëª©í‘œ EC/pHê¹Œì§€)
    â‘¢  ê´€ìˆ˜ íŒí”„ ON
    â‘£  ë°¸ë¸Œ 1ë²ˆë¶€í„° ìˆœì„œëŒ€ë¡œ ì—´ê¸° (ì„¤ì • ì‹œê°„/ìœ ëŸ‰ë§Œí¼)
    â‘¤  ëª¨ë“  ë°¸ë¸Œ ì™„ë£Œ â†’ ëª¨ë“  ì¥ë¹„ OFF â†’ ì‹¤ì  ê¸°ë¡
```

### ì‹œë‚˜ë¦¬ì˜¤ 4: ë¹„ìƒ ì •ì§€ (ì›ê²©)

```
ê´€ë¦¬ìê°€ "ë¹„ìƒì •ì§€" ë²„íŠ¼ í´ë¦­
         â”‚
         â–¼
    Frontend â†’ REST API â†’ Cloud Server
         â”‚
         â–¼
    MQTT ë°œí–‰: farm/{farmId}/command { type: "EMERGENCY_STOP" }
         â”‚
         â–¼
    AWS IoT Core â†’ RPi
         â”‚
         â–¼
    Node-RED: ëª¨ë“  ë°¸ë¸Œ OFF, ëª¨ë“  íŒí”„ OFF
         â”‚
         â–¼
    MQTT ì‘ë‹µ: farm/{farmId}/command/ack { success: true }
```

---

## 4. í´ë”ë³„ ìƒì„¸ ì„¤ëª…

### 4-1. cloud-server/ (ì‚¬ë¬´ì‹¤ ì„œë²„)

ì‚¬ë¬´ì‹¤ì— ë†“ëŠ” ì„œë²„. ì—¬ëŸ¬ ë†ì¥ì˜ ë°ì´í„°ë¥¼ ëª¨ì•„ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.

```
cloud-server/
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ create-db.js              â† PostgreSQL DB ìƒì„± + ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
â”‚   â””â”€â”€ migrations/
â”‚       â”œâ”€â”€ 001_create_organizations.sql  â† ì¡°ì§(íšŒì‚¬) í…Œì´ë¸”
â”‚       â”œâ”€â”€ 002_create_users.sql          â† ì‚¬ìš©ì í…Œì´ë¸”
â”‚       â”œâ”€â”€ 003_create_farms.sql          â† ë†ì¥ í…Œì´ë¸”
â”‚       â”œâ”€â”€ 004_create_farm_users.sql     â† ë†ì¥-ì‚¬ìš©ì ì—°ê²° (ëˆ„ê°€ ì–´ë–¤ ë†ì¥ì— ì ‘ê·¼ ê°€ëŠ¥?)
â”‚       â”œâ”€â”€ 005_create_alarm_history.sql  â† ê²½ë³´ ì´ë ¥
â”‚       â”œâ”€â”€ 006_create_control_logs.sql   â† ì œì–´ ë¡œê·¸ (ëˆ„ê°€ ì–¸ì œ ë­˜ í–ˆëŠ”ì§€)
â”‚       â”œâ”€â”€ 007_create_daily_summary_archive.sql  â† ì¼ì¼ ì§‘ê³„ ë³´ê´€
â”‚       â””â”€â”€ 008_create_notification_settings.sql  â† ì•Œë¦¼ ì„¤ì •
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js         â† ì„œë²„ ì‹œì‘ì . DB ì—°ê²° â†’ WebSocket â†’ MQTT â†’ ì„œë²„ ì‹œì‘
â”‚   â”œâ”€â”€ app.js            â† Express ì•± ì„¤ì • (ë¯¸ë“¤ì›¨ì–´, ë¼ìš°íŠ¸ ì—°ê²°)
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js   â† PostgreSQL ì—°ê²° ì„¤ì • (Sequelize ORM)
â”‚   â”‚   â””â”€â”€ constants.js  â† ì„œë²„ ì „ìš© ìƒìˆ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ models/           â† DB í…Œì´ë¸”ì„ JavaScript ê°ì²´ë¡œ í‘œí˜„ (Sequelize ëª¨ë¸)
â”‚   â”‚   â”œâ”€â”€ index.js              â† ëª¨ë“  ëª¨ë¸ ë¡œë“œ + í…Œì´ë¸” ê°„ ê´€ê³„ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ Organization.js       â† ì¡°ì§
â”‚   â”‚   â”œâ”€â”€ User.js               â† ì‚¬ìš©ì
â”‚   â”‚   â”œâ”€â”€ Farm.js               â† ë†ì¥
â”‚   â”‚   â”œâ”€â”€ FarmUser.js           â† ë†ì¥-ì‚¬ìš©ì ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ AlarmHistory.js       â† ê²½ë³´ ì´ë ¥
â”‚   â”‚   â”œâ”€â”€ ControlLog.js         â† ì œì–´ ë¡œê·¸
â”‚   â”‚   â”œâ”€â”€ DailySummaryArchive.js â† ì¼ì¼ ì§‘ê³„
â”‚   â”‚   â””â”€â”€ NotificationSetting.js â† ì•Œë¦¼ ì„¤ì •
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/        â† ìš”ì²­ì´ ë¼ìš°íŠ¸ì— ë„ë‹¬í•˜ê¸° ì „ì— ê±°ì¹˜ëŠ” ê´€ë¬¸
â”‚   â”‚   â”œâ”€â”€ auth.js        â† JWT í† í° í™•ì¸ ("ì´ ì‚¬ëŒì´ ë¡œê·¸ì¸í•œ ì‚¬ëŒ ë§ë‚˜?")
â”‚   â”‚   â”œâ”€â”€ roleCheck.js   â† ê¶Œí•œ í™•ì¸ ("ì´ ì‚¬ëŒì´ ì´ ë†ì¥ì„ ì œì–´í•  ìˆ˜ ìˆë‚˜?")
â”‚   â”‚   â””â”€â”€ rateLimiter.js â† ìš”ì²­ ì œí•œ (1ë¶„ì— 100íšŒê¹Œì§€ë§Œ í—ˆìš©)
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/            â† API ê²½ë¡œ ì •ì˜ ("ì´ URLë¡œ ì˜¤ë©´ ì´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ë¼")
â”‚   â”‚   â”œâ”€â”€ index.js       â† ëª¨ë“  ë¼ìš°íŠ¸ë¥¼ í•œê³³ì— ëª¨ì•„ì„œ ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ auth.js        â† ë¡œê·¸ì¸/íšŒì›ê°€ì…/ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ [POST /api/auth/login ë“±]
â”‚   â”‚   â”œâ”€â”€ users.js       â† ì‚¬ìš©ì ê´€ë¦¬ [GET/POST/PUT/DELETE /api/users]
â”‚   â”‚   â”œâ”€â”€ farms.js       â† ë†ì¥ ê´€ë¦¬ [GET/POST/PUT /api/farms]
â”‚   â”‚   â”œâ”€â”€ farmConfig.js      â† ë†ì¥ ì„¤ì • ì¡°íšŒ/ë³€ê²½ â†’ MQTTë¡œ RPiì— ì „ë‹¬
â”‚   â”‚   â”œâ”€â”€ farmPrograms.js    â† ê´€ìˆ˜ í”„ë¡œê·¸ë¨ ì¡°íšŒ/ë³€ê²½ â†’ MQTTë¡œ RPiì— ì „ë‹¬
â”‚   â”‚   â”œâ”€â”€ farmControl.js     â† ì›ê²© ì œì–´ (ë¹„ìƒì •ì§€/ì‹œì‘/ì •ì§€/ìˆ˜ë™) â†’ MQTT
â”‚   â”‚   â”œâ”€â”€ farmAlarms.js      â† ê²½ë³´ ì´ë ¥ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ farmControlLogs.js â† ì œì–´ ë¡œê·¸ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ farmDailySummary.js â† ì¼ì¼ ì§‘ê³„ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ admin.js            â† ê´€ë¦¬ì ì „ìš© (ì „ì²´ í˜„í™©, ì˜¤í”„ë¼ì¸ ë†ì¥ ë“±)
â”‚   â”‚   â””â”€â”€ notifications.js    â† ì•Œë¦¼ ì„¤ì •
â”‚   â”‚
â”‚   â””â”€â”€ services/          â† í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê³„ì† ëŒì•„ê°€ëŠ” ê²ƒë“¤)
â”‚       â”œâ”€â”€ mqttBridgeService.js  â† AWS IoT MQTT ì—°ê²°. RPië“¤ì˜ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•´ì„œ DB ì €ì¥
â”‚       â”œâ”€â”€ farmWsService.js      â† WebSocket ì„œë¹„ìŠ¤. ë¸Œë¼ìš°ì €ì— ì‹¤ì‹œê°„ ë°ì´í„° ì „ë‹¬
â”‚       â”œâ”€â”€ alarmNotifier.js      â† ê²½ë³´ ë°œìƒ ì‹œ ì´ë©”ì¼ ì•Œë¦¼ ì „ì†¡
â”‚       â””â”€â”€ offlineMonitor.js     â† 1ë¶„ë§ˆë‹¤ ë†ì¥ì´ ì‚´ì•„ìˆëŠ”ì§€ í™•ì¸ (Heartbeat ê¸°ë°˜)
â”‚
â”œâ”€â”€ .env.example          â† í™˜ê²½ë³€ìˆ˜ í…œí”Œë¦¿ (ë³µì‚¬í•´ì„œ .envë¡œ ì‚¬ìš©)
â””â”€â”€ package.json          â† ì˜ì¡´ì„± ëª©ë¡
```

### 4-2. rpi-server/ (ë¼ì¦ˆë² ë¦¬íŒŒì´ ì„œë²„)

ê° ë†ì¥ì— 1ëŒ€ì”© ì„¤ì¹˜ë˜ëŠ” ì„œë²„. ì„¼ì„œë¥¼ ì½ê³  ë°¸ë¸Œë¥¼ ì œì–´í•©ë‹ˆë‹¤.

```
rpi-server/
â”œâ”€â”€ database/
â”‚   â””â”€â”€ init.js           â† SQLite DB ì´ˆê¸°í™”. í…Œì´ë¸” 8ê°œ ìƒì„± + ê¸°ë³¸ ë°ì´í„° ì‚½ì…
â”‚                            (í”„ë¡œê·¸ë¨ 6ê°œ Ã— ë°¸ë¸Œ 14ê°œ = 84ê°œ ë°¸ë¸Œ ì„¤ì • ìë™ ìƒì„±)
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js         â† ì„œë²„ ì‹œì‘ì . WebSocket â†’ MQTT â†’ Heartbeat â†’ ì„œë²„ ì‹œì‘
â”‚   â”œâ”€â”€ app.js            â† Express ì•± + ë¹Œë“œëœ í”„ë¡ íŠ¸ì—”ë“œ ì •ì  ì„œë¹™ (í„°ì¹˜íŒ¨ë„ìš©)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/            â† SQLite í…Œì´ë¸” ëª¨ë¸ (better-sqlite3 ë™ê¸° API)
â”‚   â”‚   â”œâ”€â”€ index.js               â† ëª¨ë“  ëª¨ë¸ ë¡œë“œ
â”‚   â”‚   â”œâ”€â”€ SystemConfig.js        â† ì‹œìŠ¤í…œ ì„¤ì • (1í–‰ë§Œ ì¡´ì¬. ë†ì¥ ì´ë¦„, EC/pH ì„¤ì •ê°’ ë“±)
â”‚   â”‚   â”œâ”€â”€ IrrigationProgram.js   â† ê´€ìˆ˜ í”„ë¡œê·¸ë¨ 6ê°œ
â”‚   â”‚   â”œâ”€â”€ ValveConfig.js         â† ë°¸ë¸Œ ì„¤ì • 84ê°œ (6í”„ë¡œê·¸ë¨ Ã— 14ë°¸ë¸Œ)
â”‚   â”‚   â”œâ”€â”€ SensorData.js          â† ì„¼ì„œ ë°ì´í„° ê¸°ë¡
â”‚   â”‚   â”œâ”€â”€ DailySummary.js        â† ì¼ì¼ ì§‘ê³„
â”‚   â”‚   â”œâ”€â”€ DailyValveFlow.js      â† ë°¸ë¸Œë³„ ì¼ì¼ ìœ ëŸ‰
â”‚   â”‚   â”œâ”€â”€ AlarmLog.js            â† ê²½ë³´ ë¡œê·¸
â”‚   â”‚   â””â”€â”€ LocalUser.js           â† ë¡œì»¬ ì‚¬ìš©ì (ê¸°ë³¸: admin / admin1234)
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js        â† ë¡œì»¬ JWT ì¸ì¦
â”‚   â”‚   â””â”€â”€ localOnly.js   â† 127.0.0.1ì—ì„œë§Œ ì ‘ê·¼ í—ˆìš© (Node-RED ì „ìš© API ë³´í˜¸)
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ index.js       â† ë¼ìš°íŠ¸ í†µí•©
â”‚   â”‚   â”œâ”€â”€ auth.js        â† ë¡œì»¬ ë¡œê·¸ì¸ (í„°ì¹˜íŒ¨ë„ â†’ ì‚¬ìš©ìëª…/ë¹„ë°€ë²ˆí˜¸)
â”‚   â”‚   â”œâ”€â”€ config.js      â† ì‹œìŠ¤í…œ ì„¤ì • ì¡°íšŒ/ë³€ê²½
â”‚   â”‚   â”œâ”€â”€ programs.js    â† ê´€ìˆ˜ í”„ë¡œê·¸ë¨ ì¡°íšŒ/ë³€ê²½
â”‚   â”‚   â”œâ”€â”€ status.js      â† í˜„ì¬ ìš´ì „ ìƒíƒœ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ sensors.js     â† ì„¼ì„œ ë°ì´í„° ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ control.js     â† ë¡œì»¬ ì œì–´ (ë¹„ìƒì •ì§€/ì‹œì‘/ì •ì§€)
â”‚   â”‚   â”œâ”€â”€ dailySummary.js â† ì¼ì¼ ì§‘ê³„ ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ alarms.js       â† ê²½ë³´ ì¡°íšŒ
â”‚   â”‚   â””â”€â”€ internal.js     â† â˜… Node-RED ì „ìš© API (localhostë§Œ ì ‘ê·¼ ê°€ëŠ¥)
â”‚   â”‚                          - POST /internal/sensor-update (ì„¼ì„œ ë°ì´í„° ìˆ˜ì‹ )
â”‚   â”‚                          - POST /internal/status-update (ì¥ë¹„ ìƒíƒœ ìˆ˜ì‹ )
â”‚   â”‚                          - POST /internal/alarm (ê²½ë³´ ë“±ë¡)
â”‚   â”‚                          - GET  /internal/programs (í”„ë¡œê·¸ë¨ ì¡°íšŒ)
â”‚   â”‚                          - GET  /internal/config (ì„¤ì • ì¡°íšŒ)
â”‚   â”‚
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ mqttService.js      â† AWS IoT ì—°ê²°. ì›ê²© ëª…ë ¹ ìˆ˜ì‹ , ì„¤ì • ë³€ê²½ ìˆ˜ì‹ 
â”‚       â”œâ”€â”€ publisherService.js â† â˜… í•µì‹¬! ìš”ì²­ ì‹œì—ë§Œ ì„¼ì„œ ë°ì´í„°ë¥¼ 3ì´ˆë§ˆë‹¤ MQTT ë°œí–‰
â”‚       â”œâ”€â”€ controlService.js   â† ëª…ë ¹ ì‹¤í–‰ê¸° (ë¹„ìƒì •ì§€/ì‹œì‘/ì •ì§€/ìˆ˜ë™)
â”‚       â”œâ”€â”€ wsService.js        â† í„°ì¹˜íŒ¨ë„ìš© WebSocket (1ì´ˆë§ˆë‹¤ ìƒíƒœ ì „ì†¡)
â”‚       â”œâ”€â”€ sensorCache.js      â† ì„¼ì„œ ë°ì´í„° ë©”ëª¨ë¦¬ ìºì‹œ (ë¹ ë¥¸ ì¡°íšŒìš©)
â”‚       â”œâ”€â”€ alarmService.js     â† ê²½ë³´ ê°ì‹œ (EC/pH/ì˜¨ë„ ì„ê³„ê°’ ì²´í¬)
â”‚       â”œâ”€â”€ heartbeatService.js â† 60ì´ˆë§ˆë‹¤ "ë‚˜ ì‚´ì•„ìˆì–´" ì‹ í˜¸ AWSë¡œ ì „ì†¡
â”‚       â””â”€â”€ dailySyncService.js â† ë§¤ì¼ 00:05ì— ì¼ì¼ ì§‘ê³„ë¥¼ AWSë¡œ ì „ì†¡
â”‚
â”œâ”€â”€ .env.example
â””â”€â”€ package.json
```

### 4-3. frontend/ (í”„ë¡ íŠ¸ì—”ë“œ)

í„°ì¹˜íŒ¨ë„ê³¼ ì‚¬ë¬´ì‹¤ PCì—ì„œ **ê°™ì€ ì½”ë“œ**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì ‘ì† ì£¼ì†Œ(hostname)ë¡œ ëª¨ë“œë¥¼ ìë™ íŒë³„í•©ë‹ˆë‹¤.

```
frontend/
â”œâ”€â”€ index.html            â† HTML ì§„ì…ì 
â”œâ”€â”€ vite.config.js        â† Vite ë¹Œë“œ ì„¤ì • (í”„ë¡ì‹œ: /api â†’ 3000, /ws â†’ 3000)
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.jsx          â† React ì•± ì‹œì‘ì 
â”‚   â”œâ”€â”€ App.jsx           â† â˜… ë¼ìš°í„°. ë¡œì»¬/ì›ê²© ëª¨ë“œë³„ë¡œ ë‹¤ë¥¸ ê²½ë¡œ ì‚¬ìš©
â”‚   â”œâ”€â”€ theme.js          â† MUI í…Œë§ˆ (ë°ì€ ìƒ‰, 7ì¸ì¹˜ í„°ì¹˜ ìµœì í™”, ìµœì†Œ 44px í„°ì¹˜ ì˜ì—­)
â”‚   â”‚
â”‚   â”œâ”€â”€ store/             â† ìƒíƒœ ê´€ë¦¬ (Zustand) â€” Reactì˜ ì „ì—­ ë³€ìˆ˜ ì €ì¥ì†Œ
â”‚   â”‚   â”œâ”€â”€ authStore.js   â† ë¡œê·¸ì¸ ìƒíƒœ (í† í°, ì‚¬ìš©ì ì •ë³´)
â”‚   â”‚   â”œâ”€â”€ systemStore.js â† ì‹œìŠ¤í…œ ìƒíƒœ (ì„¼ì„œê°’, ë°¸ë¸Œìƒíƒœ, íƒ±í¬ìˆ˜ìœ„ ë“±)
â”‚   â”‚   â””â”€â”€ farmStore.js   â† ë†ì¥ ëª©ë¡ (ì›ê²© ëª¨ë“œì—ì„œ ì‚¬ìš©)
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/             â† ì»¤ìŠ¤í…€ í›… â€” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¡œì§ ëª¨ìŒ
â”‚   â”‚   â”œâ”€â”€ useConnectionMode.js  â† localhostë©´ 'local', ì•„ë‹ˆë©´ 'remote' ë°˜í™˜
â”‚   â”‚   â”œâ”€â”€ useAuth.js            â† ë¡œê·¸ì¸ ì²˜ë¦¬ (ëª¨ë“œì— ë”°ë¼ ë‹¤ë¥¸ API í˜¸ì¶œ)
â”‚   â”‚   â”œâ”€â”€ useApi.js             â† Axios HTTP í´ë¼ì´ì–¸íŠ¸ (JWT ìë™ ì²¨ë¶€)
â”‚   â”‚   â”œâ”€â”€ useLocalWebSocket.js  â† RPi WebSocket ì—°ê²° (í„°ì¹˜íŒ¨ë„ìš©)
â”‚   â”‚   â”œâ”€â”€ useCloudWebSocket.js  â† ì‚¬ë¬´ì‹¤ ì„œë²„ WebSocket ì—°ê²° (ì›ê²©ìš©)
â”‚   â”‚   â””â”€â”€ useRealtimeData.js    â† ëª¨ë“œì— ë”°ë¼ ì ì ˆí•œ WebSocket ìë™ ì„ íƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ constants.js   â† í”„ë¡ íŠ¸ì—”ë“œ ìƒìˆ˜ (API URL, ë°¸ë¸Œ ìˆ˜, ë¼ë²¨ ë“±)
â”‚   â”‚   â””â”€â”€ helpers.js     â† ìœ í‹¸ í•¨ìˆ˜ (ë‚ ì§œ í¬ë§·, ìˆ«ì í¬ë§· ë“±)
â”‚   â”‚
â”‚   â”œâ”€â”€ components/        â† ì¬ì‚¬ìš© UI ë¶€í’ˆ
â”‚   â”‚   â”œâ”€â”€ Header.jsx          â† ìƒë‹¨ ë°” (36px. ë†ì¥ëª… + ë©”ë‰´ ì•„ì´ì½˜ 8ê°œ + ì‹œê³„)
â”‚   â”‚   â”œâ”€â”€ StatusPanel.jsx     â† ì™¼ìª½ ìƒíƒœ íŒ¨ë„ (180px. 12ê°œ ìƒíƒœ í•­ëª©)
â”‚   â”‚   â”œâ”€â”€ TankVisualizer.jsx  â† íƒ±í¬ ì‹œê°í™” (80px. 7ê°œ ì‚¬ë‹¤ë¦¬ê¼´ SVG)
â”‚   â”‚   â”œâ”€â”€ PipeDiagram.jsx     â† ë°°ê´€ë„ (200px. íŒŒì´í”„ + ì„¼ì„œê°’ 6ê°œ)
â”‚   â”‚   â”œâ”€â”€ SolarRadiationTable.jsx â† ì¼ì‚¬ëŸ‰ í…Œì´ë¸” (110px. 6ì—´)
â”‚   â”‚   â”œâ”€â”€ EmergencyButton.jsx â† ë¹„ìƒì •ì§€/ì‹œì‘/ìˆ˜ë™ ë²„íŠ¼ (50px)
â”‚   â”‚   â”œâ”€â”€ AlarmBanner.jsx     â† ê²½ë³´ ë°°ë„ˆ (28px. ê²½ë³´ ì‹œì—ë§Œ í‘œì‹œ)
â”‚   â”‚   â”œâ”€â”€ SensorGauge.jsx     â† ì„¼ì„œ ê²Œì´ì§€ (ë²”ìœ„ ë°” í¬í•¨)
â”‚   â”‚   â”œâ”€â”€ ValveIndicator.jsx  â† ë°¸ë¸Œ ìƒíƒœ í‘œì‹œ (ì´ˆë¡=ì—´ë¦¼, íšŒìƒ‰=ë‹«í˜)
â”‚   â”‚   â”œâ”€â”€ FarmCard.jsx        â† ë†ì¥ ì„ íƒ ì¹´ë“œ (ì›ê²© ëª¨ë“œ)
â”‚   â”‚   â””â”€â”€ PasswordDialog.jsx  â† ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë‹¤ì´ì–¼ë¡œê·¸
â”‚   â”‚
â”‚   â””â”€â”€ pages/             â† í™”ë©´(í˜ì´ì§€) â€” ê° URLì— ëŒ€ì‘
â”‚       â”œâ”€â”€ Login.jsx           â† ë¡œê·¸ì¸ (ë¡œì»¬: ì‚¬ìš©ìëª…, ì›ê²©: ì´ë©”ì¼)
â”‚       â”œâ”€â”€ FarmSelector.jsx    â† ë†ì¥ ì„ íƒ (ì›ê²© ëª¨ë“œ ì „ìš©)
â”‚       â”‚
â”‚       â”œâ”€â”€ farm/               â† ë†ì¥ í™”ë©´ë“¤
â”‚       â”‚   â”œâ”€â”€ Dashboard.jsx       â† â˜… ë©”ì¸ ëŒ€ì‹œë³´ë“œ (1024Ã—600, ìŠ¤í¬ë¡¤ ì—†ìŒ)
â”‚       â”‚   â”œâ”€â”€ Settings.jsx        â† í™˜ê²½ ì„¤ì • (í”„ë¡œê·¸ë¨, ê¸°ëŠ¥, í™˜ê²½ ì„¤ì •)
â”‚       â”‚   â”œâ”€â”€ ProgramDetail.jsx   â† í”„ë¡œê·¸ë¨ ìƒì„¸ (íŠ¸ë¦¬ê±°, ë°¸ë¸Œ, EC/pH ì„¤ì •)
â”‚       â”‚   â”œâ”€â”€ DailySummary.jsx    â† ì¼ì¼ ì§‘ê³„ (ë‚ ì§œë³„ ê´€ìˆ˜ ì‹¤ì )
â”‚       â”‚   â”œâ”€â”€ Alarms.jsx          â† ê²½ë³´ ì´ë ¥ (í˜ì´ì§€ë„¤ì´ì…˜)
â”‚       â”‚   â””â”€â”€ ManualControl.jsx   â† ìˆ˜ë™ ì œì–´ (14ê°œ ë°¸ë¸Œ í† ê¸€)
â”‚       â”‚
â”‚       â””â”€â”€ admin/              â† ê´€ë¦¬ì í™”ë©´ë“¤ (ì›ê²© ëª¨ë“œ, admin ì´ìƒë§Œ)
â”‚           â”œâ”€â”€ SystemOverview.jsx   â† ì‹œìŠ¤í…œ ì „ì²´ í˜„í™© (ì¹´ë“œ 4ê°œ + ì°¨íŠ¸)
â”‚           â”œâ”€â”€ UserManagement.jsx   â† ì‚¬ìš©ì ê´€ë¦¬ (CRUD + ë†ì¥ ê¶Œí•œ)
â”‚           â”œâ”€â”€ FarmManagement.jsx   â† ë†ì¥ ê´€ë¦¬ (ë“±ë¡/ìˆ˜ì •/ë¹„í™œì„±í™”)
â”‚           â”œâ”€â”€ AlarmCenter.jsx      â† ê²½ë³´ ì„¼í„° (ì „ì²´ ë†ì¥ ê²½ë³´ í†µí•©)
â”‚           â””â”€â”€ ControlLogs.jsx      â† ì œì–´ ë¡œê·¸ (í•„í„° + CSV ë‹¤ìš´ë¡œë“œ)
â”‚
â”œâ”€â”€ .env.example
â””â”€â”€ package.json
```

### 4-4. shared/ (ê³µìœ  ëª¨ë“ˆ)

```
shared/
â”œâ”€â”€ constants.js    â† ë°¸ë¸Œ 14ê°œ, í”„ë¡œê·¸ë¨ 6ê°œ, íƒ±í¬ 7ê°œ, ì—­í• , ê²½ë³´ ìœ í˜• ë“±
â””â”€â”€ mqttTopics.js   â† MQTT í† í”½ íŒ¨í„´ ì •ì˜ (farm/{farmId}/telemetry ë“±)
```

cloud-serverì™€ rpi-serverê°€ `require('../../../shared/constants')` í˜•íƒœë¡œ ë¶ˆëŸ¬ë‹¤ ì”ë‹ˆë‹¤.

### 4-5. node-red/ (ì„¼ì„œ + ìë™í™”)

```
node-red/
â”œâ”€â”€ flows.json     â† Node-RED í”Œë¡œìš° ì •ì˜ (82ê°œ ë…¸ë“œ, 10ê°œ íƒ­)
â””â”€â”€ settings.js    â† Node-RED ì„¤ì • (ê´€ë¦¬ì ì¸ì¦, ê¸€ë¡œë²Œ ì»¨í…ìŠ¤íŠ¸ ë“±)
```

### 4-6. docker/ (ì‚¬ë¬´ì‹¤ ì„œë²„ ë°°í¬)

```
docker/
â”œâ”€â”€ docker-compose.yml    â† 3ê°œ ì„œë¹„ìŠ¤ ì •ì˜ (postgres + cloud-server + nginx)
â”œâ”€â”€ Dockerfile.cloud      â† cloud-server ë„ì»¤ ì´ë¯¸ì§€
â”œâ”€â”€ Dockerfile.frontend   â† frontend ë¹Œë“œ â†’ nginx ì„œë¹™ ì´ë¯¸ì§€
â”œâ”€â”€ nginx.conf            â† Nginx ì„¤ì • (SPA + API í”„ë¡ì‹œ + WebSocket í”„ë¡ì‹œ)
â””â”€â”€ .env.example          â† Dockerìš© í™˜ê²½ë³€ìˆ˜ í…œí”Œë¦¿
```

### 4-7. scripts/ (RPi ë°°í¬)

```
scripts/
â”œâ”€â”€ setup-rpi.sh          â† RPi ìµœì´ˆ ì„¤ì • (Node.js, PM2, Node-RED ì„¤ì¹˜)
â”œâ”€â”€ deploy-rpi.sh         â† RPiì— ì½”ë“œ ë°°í¬ (ë¹Œë“œ, DB ì´ˆê¸°í™”, PM2 ì‹œì‘)
â””â”€â”€ ecosystem.config.js   â† PM2 í”„ë¡œì„¸ìŠ¤ ì„¤ì • (rpi-server + node-red)
```

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### PostgreSQL (cloud-server) â€” ì „ì²´ ë†ì¥ ì¤‘ì•™ ê´€ë¦¬

```
organizations (ì¡°ì§/íšŒì‚¬)
  â””â”€â”€ users (ì‚¬ìš©ì)
        â””â”€â”€ farm_users (ë†ì¥ ì ‘ê·¼ ê¶Œí•œ)
              â””â”€â”€ farms (ë†ì¥)
                    â”œâ”€â”€ alarm_history (ê²½ë³´ ì´ë ¥)
                    â”œâ”€â”€ control_logs (ì œì–´ ë¡œê·¸)
                    â”œâ”€â”€ daily_summary_archive (ì¼ì¼ ì§‘ê³„)
                    â””â”€â”€ notification_settings (ì•Œë¦¼ ì„¤ì •)
```

**ì—­í•  ì²´ê³„:**
| ì—­í•  | ì„¤ëª… | í•  ìˆ˜ ìˆëŠ” ê²ƒ |
|------|------|--------------|
| superadmin | ì‹œìŠ¤í…œ ì „ì²´ ê´€ë¦¬ì | ëª¨ë“  ê²ƒ |
| admin | ì¡°ì§ ê´€ë¦¬ì | ì‚¬ìš©ì ê´€ë¦¬, ë†ì¥ ë“±ë¡, ì œì–´ |
| operator | ìš´ì˜ì | ë†ì¥ ì œì–´ (ì„¤ì • ë³€ê²½, ê´€ìˆ˜ ì‹œì‘/ì •ì§€) |
| viewer | ë·°ì–´ | ì¡°íšŒë§Œ ê°€ëŠ¥ |

### SQLite (rpi-server) â€” ê° ë†ì¥ ë…ë¦½ ìš´ì˜

```
system_config (1í–‰)          â† ë†ì¥ ì „ì²´ ì„¤ì •ê°’
irrigation_program (6í–‰)     â† ê´€ìˆ˜ í”„ë¡œê·¸ë¨ 6ê°œ
valve_config (84í–‰)          â† 6 í”„ë¡œê·¸ë¨ Ã— 14 ë°¸ë¸Œ = 84ê°œ ê°œë³„ ì„¤ì •
sensor_data                  â† ì„¼ì„œ ë°ì´í„° ì‹œê³„ì—´ ê¸°ë¡
daily_summary                â† ì¼ì¼ ìš´ì˜ ì§‘ê³„
daily_valve_flow             â† ë°¸ë¸Œë³„ ì¼ì¼ ìœ ëŸ‰
alarm_log                    â† ê²½ë³´ ë¡œê·¸
local_users                  â† ë¡œì»¬ ì‚¬ìš©ì (ê¸°ë³¸: admin / admin1234)
```

---

## 6. í™”ë©´(í˜ì´ì§€) êµ¬ì„±

### ì ‘ì† ëª¨ë“œì— ë”°ë¥¸ í™”ë©´ ì°¨ì´

| | ë¡œì»¬ ëª¨ë“œ (í„°ì¹˜íŒ¨ë„) | ì›ê²© ëª¨ë“œ (ì‚¬ë¬´ì‹¤ PC) |
|---|---|---|
| íŒë³„ ê¸°ì¤€ | hostname = localhost | hostname = ì„œë²„ ì£¼ì†Œ |
| ë¡œê·¸ì¸ ë°©ì‹ | ì‚¬ìš©ìëª… + ë¹„ë°€ë²ˆí˜¸ | ì´ë©”ì¼ + ë¹„ë°€ë²ˆí˜¸ |
| ì²« í™”ë©´ | ë°”ë¡œ ëŒ€ì‹œë³´ë“œ | ë†ì¥ ì„ íƒ í™”ë©´ |
| ê´€ë¦¬ì ë©”ë‰´ | ì—†ìŒ | ìˆìŒ (admin ì´ìƒ) |
| URL íŒ¨í„´ | `/settings` | `/farm/{farmId}/settings` |

### ë¡œì»¬ ëª¨ë“œ ë¼ìš°íŠ¸ (í„°ì¹˜íŒ¨ë„)

```
/login              â†’ ë¡œê·¸ì¸
/                   â†’ ëŒ€ì‹œë³´ë“œ (ë©”ì¸ í™”ë©´)
/settings           â†’ í™˜ê²½ ì„¤ì •
/program/:id        â†’ í”„ë¡œê·¸ë¨ ìƒì„¸
/daily-summary      â†’ ì¼ì¼ ì§‘ê³„
/alarms             â†’ ê²½ë³´ ì´ë ¥
/manual             â†’ ìˆ˜ë™ ì œì–´
```

### ì›ê²© ëª¨ë“œ ë¼ìš°íŠ¸ (ì‚¬ë¬´ì‹¤)

```
/login                          â†’ ë¡œê·¸ì¸
/                               â†’ ë†ì¥ ì„ íƒ
/farm/:farmId                   â†’ ëŒ€ì‹œë³´ë“œ
/farm/:farmId/settings          â†’ í™˜ê²½ ì„¤ì •
/farm/:farmId/program/:id       â†’ í”„ë¡œê·¸ë¨ ìƒì„¸
/farm/:farmId/daily-summary     â†’ ì¼ì¼ ì§‘ê³„
/farm/:farmId/alarms            â†’ ê²½ë³´ ì´ë ¥
/farm/:farmId/manual            â†’ ìˆ˜ë™ ì œì–´
/admin/overview                 â†’ ì‹œìŠ¤í…œ í˜„í™©
/admin/users                    â†’ ì‚¬ìš©ì ê´€ë¦¬
/admin/farms                    â†’ ë†ì¥ ê´€ë¦¬
/admin/alarms                   â†’ ê²½ë³´ ì„¼í„°
/admin/logs                     â†’ ì œì–´ ë¡œê·¸
```

### ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ (1024 Ã— 600px, ìŠ¤í¬ë¡¤ ì—†ìŒ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš  ê²½ë³´ ë°°ë„ˆ (ê²½ë³´ ì‹œì—ë§Œ í‘œì‹œ, 28px)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ  ë†ì¥ëª… | âš™ ğŸ“Š ğŸ”” ğŸ› | 14:30 ğŸŸ¢           â”‚ â† Header (36px)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ìƒíƒœ    â”‚  [A][B][C][D][E][F][ì‚°]              â”‚ â† íƒ±í¬ 7ê°œ (80px)
â”‚ íŒ¨ë„    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚  â•â•â•¦â•â•â•¦â•â•â•¦â•â•  EC:1.2 pH:6.1         â”‚ â† ë°°ê´€ë„ + ì„¼ì„œ (200px)
â”‚ EC 1.2  â”‚  â•â•â•©â•â•â•©â•â•â•©â•â•  ì˜¨ë„:25 ìœ ëŸ‰:50       â”‚
â”‚ pH 6.1  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì˜¨ë„ 25  â”‚  ì‹œê°„ | ì¼ì‚¬ëŸ‰ | ì ì‚° | P1 | P2 | P3  â”‚ â† ì¼ì‚¬ëŸ‰ í…Œì´ë¸” (110px)
â”‚ ...     â”‚  09:00 | 450  | 1200 | O  | - | -   â”‚
â”‚ (180px) â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚  [ğŸ”´ ë¹„ìƒì •ì§€] [â–¶ ì‹œì‘] [ğŸ”§ ìˆ˜ë™]      â”‚ â† ë²„íŠ¼ (50px)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          ì´ ë†’ì´ = 28+36+80+200+110+50 = 504px (â‰¤ 600px)
```

---

## 7. MQTT í†µì‹  ê·œì¹™

### í† í”½ íŒ¨í„´

ëª¨ë“  MQTT ë©”ì‹œì§€ëŠ” `farm/{farmId}/` ì ‘ë‘ì‚¬ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.

```
farm/MyFarm01/telemetry       â† ì„¼ì„œ ë°ì´í„° (EC, pH, ì˜¨ë„ ë“±)
farm/MyFarm01/status          â† ì¥ë¹„ ìƒíƒœ (ë°¸ë¸Œ, íŒí”„, ìš´ì „ìƒíƒœ)
farm/MyFarm01/alarm           â† ê²½ë³´ ë°œìƒ
farm/MyFarm01/command         â† ì›ê²© ì œì–´ ëª…ë ¹
farm/MyFarm01/command/ack     â† ëª…ë ¹ ì‹¤í–‰ ê²°ê³¼
farm/MyFarm01/config/update   â† ì„¤ì • ë³€ê²½
farm/MyFarm01/request/start   â† "ì„¼ì„œ ë°ì´í„° ë³´ë‚´ê¸° ì‹œì‘í•´"
farm/MyFarm01/request/stop    â† "ì„¼ì„œ ë°ì´í„° ë³´ë‚´ê¸° ë©ˆì¶°"
farm/MyFarm01/heartbeat       â† "ë‚˜ ì‚´ì•„ìˆì–´" (60ì´ˆë§ˆë‹¤)
farm/MyFarm01/daily-summary   â† ì¼ì¼ ì§‘ê³„ (í•˜ë£¨ 1íšŒ)
```

### ëˆ„ê°€ ë³´ë‚´ê³  ëˆ„ê°€ ë°›ë‚˜?

```
              RPiê°€ ë°œí–‰                    ì‚¬ë¬´ì‹¤ ì„œë²„ê°€ ë°œí–‰
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         telemetry    â”€â”€â”€â†’              command         â”€â”€â”€â†’
         status       â”€â”€â”€â†’              config/update   â”€â”€â”€â†’
         alarm        â”€â”€â”€â†’              request/start   â”€â”€â”€â†’
         command/ack  â”€â”€â”€â†’              request/stop    â”€â”€â”€â†’
         heartbeat    â”€â”€â”€â†’
         daily-summary â”€â”€â”€â†’
                          â†•
                    AWS IoT Core
                    (ë©”ì‹œì§€ ì¤‘ê³„ì†Œ)
```

### ë¹„ìš©ì„ ì•„ë¼ëŠ” í•µì‹¬ ì›ì¹™

| í† í”½ | ë°œí–‰ ì¡°ê±´ | ë¹„ìš© ì˜í–¥ |
|------|----------|----------|
| heartbeat | **í•­ìƒ** (60ì´ˆë§ˆë‹¤) | ë†ì¥ë‹¹ í•˜ë£¨ 1,440ê±´ |
| daily-summary | **í•­ìƒ** (í•˜ë£¨ 1íšŒ) | ë†ì¥ë‹¹ í•˜ë£¨ 1ê±´ |
| alarm | ê²½ë³´ ë°œìƒ ì‹œì—ë§Œ | ë§¤ìš° ì ìŒ |
| telemetry, status | **ëˆ„êµ°ê°€ ë³¼ ë•Œë§Œ!** | request/start~stop ì‚¬ì´ì—ë§Œ |

1,000ê°œ ë†ì¥ ê¸°ì¤€ ì›” ì•½ $90 ì˜ˆìƒ (ìì„¸í•œ ë‚´ìš©ì€ `docs/aws-iot-setup.md` ì°¸ê³ )

---

## 8. Node-REDê°€ í•˜ëŠ” ì¼

Node-REDëŠ” ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ì‹¤í–‰ë˜ëŠ” **ì‹œê°ì  í”„ë¡œê·¸ë˜ë° ë„êµ¬**ì…ë‹ˆë‹¤.
ì„¼ì„œë¥¼ ì½ê³ , ê´€ìˆ˜ë¥¼ ìë™í™”í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

### 10ê°œ í”Œë¡œìš° ìš”ì•½

| # | í”Œë¡œìš° ì´ë¦„ | ì£¼ê¸° | í•˜ëŠ” ì¼ |
|---|-----------|------|--------|
| 1 | ì„¼ì„œ ìˆ˜ì§‘ | 2ì´ˆ | ì„¼ì„œ ì½ê¸° â†’ Express /internal/sensor-update |
| 2 | ì¥ë¹„ ìƒíƒœ ìˆ˜ì§‘ | 5ì´ˆ | ë°¸ë¸Œ/íŒí”„ ìƒíƒœ â†’ Express /internal/status-update |
| 3 | ê´€ìˆ˜ ìŠ¤ì¼€ì¤„ëŸ¬ | 10ì´ˆ | íŠ¸ë¦¬ê±° ì¡°ê±´ í™•ì¸ (ì¼ì‚¬ëŸ‰/ê°„ê²©/ì‹œê°„) |
| 4 | ê´€ìˆ˜ ì‹œí€€ìŠ¤ | ì´ë²¤íŠ¸ | 5ë‹¨ê³„ ê´€ìˆ˜ ì‹¤í–‰ (íŒí”„â†’í˜¼í•©â†’ê´€ìˆ˜â†’ë°¸ë¸Œâ†’ì™„ë£Œ) |
| 5 | ê²½ë³´ ì²˜ë¦¬ | 3ì´ˆ | ì„¼ì„œ ì„ê³„ê°’ ì´ˆê³¼ í™•ì¸ â†’ Express /internal/alarm |
| 6 | ë¹„ìƒì •ì§€ | ì´ë²¤íŠ¸ | HTTP /emergency-stop ìˆ˜ì‹  â†’ ëª¨ë“  ì¥ë¹„ OFF |
| 7 | ì¼ì¼ì§‘ê³„ | ë§¤ì¼ 00:00 | í•˜ë£¨ ì‹¤ì  ê³„ì‚° â†’ Express /internal/daily-summary |
| 8 | Heartbeat | 60ì´ˆ | MQTT farm/{id}/heartbeat ë°œí–‰ (í•­ìƒ) |
| 9 | ì¼ì¼ì§‘ê³„ ì „ì†¡ | ë§¤ì¼ 00:05 | MQTT farm/{id}/daily-summary ë°œí–‰ (í•­ìƒ) |
| 10 | ì›ê²© ëª…ë ¹ ìˆ˜ì‹  | í•­ìƒ | MQTT command êµ¬ë… â†’ ì‹¤í–‰ â†’ command/ack ì‘ë‹µ |

### Node-REDì™€ Expressì˜ ê´€ê³„

```
Node-RED (í¬íŠ¸ 1880)                 RPi Express (í¬íŠ¸ 3001)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì„¼ì„œ ì½ê¸°        â”‚â”€â”€POSTâ”€â”€â”€â”€â”€â”€â†’ â”‚ /internal/sensor-updateâ”‚
â”‚ ìƒíƒœ ì½ê¸°        â”‚â”€â”€POSTâ”€â”€â”€â”€â”€â”€â†’ â”‚ /internal/status-updateâ”‚
â”‚ ê²½ë³´ ê°ì§€        â”‚â”€â”€POSTâ”€â”€â”€â”€â”€â”€â†’ â”‚ /internal/alarm        â”‚
â”‚ í”„ë¡œê·¸ë¨ ì¡°íšŒ     â”‚â”€â”€GETâ”€â”€â”€â”€â”€â”€â”€â†’ â”‚ /internal/programs     â”‚
â”‚ ì„¤ì • ì¡°íšŒ        â”‚â”€â”€GETâ”€â”€â”€â”€â”€â”€â”€â†’ â”‚ /internal/config       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                                    â†‘
  ì§ì ‘ ì„¼ì„œ/ë°¸ë¸Œ ì œì–´                     ë°ì´í„° ì €ì¥ + WebSocket ì „ì†¡
  (Modbus/GPIO)                          + MQTT ë°œí–‰ (í•„ìš” ì‹œ)
```

**í•µì‹¬**: Node-REDëŠ” ì„¼ì„œ ë°ì´í„°ë¥¼ ì§ì ‘ AWSë¡œ ë³´ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤!
Expressì˜ `publisherService`ë§Œì´ "ìš”ì²­ ë°›ì•˜ì„ ë•Œë§Œ" MQTTë¡œ ì„¼ì„œ ë°ì´í„°ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.

---

## 9. ê°œë°œ í™˜ê²½ ì‹¤í–‰ ë°©ë²•

### ì‚¬ì „ ì¤€ë¹„

| ë„êµ¬ | ë²„ì „ | ì„¤ì¹˜ ë°©ë²• |
|------|------|----------|
| Node.js | 20 LTS | https://nodejs.org |
| PostgreSQL | 15+ | https://postgresql.org |
| Git | ìµœì‹  | https://git-scm.com |

### 1ë‹¨ê³„: ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# ê° í´ë”ì—ì„œ npm install ì‹¤í–‰
cd smart-farm-system/cloud-server && npm install
cd ../rpi-server && npm install
cd ../frontend && npm install
```

### 2ë‹¨ê³„: í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```bash
# ê° í´ë”ì˜ .env.exampleì„ ë³µì‚¬í•´ì„œ .envë¥¼ ë§Œë“­ë‹ˆë‹¤
cp cloud-server/.env.example cloud-server/.env
cp rpi-server/.env.example rpi-server/.env
```

`.env` íŒŒì¼ì„ ì—´ì–´ì„œ ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤:
- **cloud-server/.env**: PostgreSQL ë¹„ë°€ë²ˆí˜¸, JWT ì‹œí¬ë¦¿



- **rpi-server/.env**: JWT ì‹œí¬ë¦¿ (AWS IoTëŠ” ê°œë°œ ì‹œ ì—†ì–´ë„ ë¨)



### 3ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

```bash
# PostgreSQL DB ìƒì„± (cloud-server)
cd cloud-server
node database/create-db.js

# SQLite DB ìƒì„± (rpi-server) â€” ìë™ìœ¼ë¡œ íŒŒì¼ ìƒì„±ë¨
cd ../rpi-server
node database/init.js
```

### 4ë‹¨ê³„: ì„œë²„ ì‹¤í–‰

í„°ë¯¸ë„ 3ê°œë¥¼ ì—´ì–´ì„œ ê°ê° ì‹¤í–‰í•©ë‹ˆë‹¤:

```bash
# í„°ë¯¸ë„ 1: Cloud Server (í¬íŠ¸ 3000)
cd cloud-server && npm run dev

# í„°ë¯¸ë„ 2: RPi Server (í¬íŠ¸ 3001)
cd rpi-server && npm run dev

# í„°ë¯¸ë„ 3: Frontend (í¬íŠ¸ 5173)
cd frontend && npm run dev
```

### 5ë‹¨ê³„: ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸

| URL | ëª¨ë“œ | ì„¤ëª… |
|-----|------|------|
| http://localhost:5173 | ë¡œì»¬ (í„°ì¹˜íŒ¨ë„) | hostnameì´ localhostì´ë¯€ë¡œ ë¡œì»¬ ëª¨ë“œ |
| http://localhost:3001 | ë¡œì»¬ (í„°ì¹˜íŒ¨ë„) | RPiì—ì„œ ì§ì ‘ ì„œë¹™í•˜ëŠ” ë¹Œë“œëœ í”„ë¡ íŠ¸ì—”ë“œ |

> ì›ê²© ëª¨ë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ localhost ëŒ€ì‹  PCì˜ ì‹¤ì œ IPë¡œ ì ‘ì†í•˜ì„¸ìš”.

---

## 10. ë°°í¬ ë°©ë²•

### ì‚¬ë¬´ì‹¤ ì„œë²„ (Docker)

```bash
cd smart-farm-system/docker

# .env íŒŒì¼ ì¤€ë¹„
cp .env.example .env
# .env íŒŒì¼ì„ í¸ì§‘í•´ì„œ ì‹¤ì œ ê°’ ì…ë ¥

# Docker ì‹¤í–‰
docker compose up -d

# ìƒíƒœ í™•ì¸
docker compose ps
```

ê²°ê³¼: `http://ì„œë²„IP:80` ìœ¼ë¡œ ì›¹ ì ‘ì† ê°€ëŠ¥

### RPi (PM2)

```bash
# 1. RPi ìµœì´ˆ ì„¤ì • (í•œ ë²ˆë§Œ)
sudo bash scripts/setup-rpi.sh

# 2. ì½”ë“œ ë°°í¬
bash scripts/deploy-rpi.sh

# 3. ìƒíƒœ í™•ì¸
pm2 status
```

ê²°ê³¼:
- `http://RPi_IP:3001` â€” í„°ì¹˜íŒ¨ë„ í™”ë©´
- `http://RPi_IP:1880/node-red` â€” Node-RED ê´€ë¦¬ í™”ë©´

---

## 11. íŒŒì¼ ëª©ë¡ ì „ì²´

ì´ **120ê°œ ì†ŒìŠ¤ íŒŒì¼** (node_modules, dist, .git ì œì™¸)

### cloud-server (25ê°œ)
```
database/create-db.js
database/migrations/001~008_*.sql (8ê°œ)
src/server.js, src/app.js
src/config/database.js, src/config/constants.js
src/models/index.js + 7ê°œ ëª¨ë¸
src/middleware/auth.js, roleCheck.js, rateLimiter.js
src/routes/index.js + 11ê°œ ë¼ìš°íŠ¸
src/services/mqttBridgeService.js, farmWsService.js, alarmNotifier.js, offlineMonitor.js
```

### rpi-server (25ê°œ)
```
database/init.js
src/server.js, src/app.js
src/models/index.js + 8ê°œ ëª¨ë¸
src/middleware/auth.js, localOnly.js
src/routes/index.js + 9ê°œ ë¼ìš°íŠ¸
src/services/mqttService.js, publisherService.js, controlService.js, wsService.js,
             sensorCache.js, alarmService.js, heartbeatService.js, dailySyncService.js
```

### frontend (35ê°œ)
```
index.html, vite.config.js
src/main.jsx, src/App.jsx, src/theme.js
src/store/authStore.js, systemStore.js, farmStore.js
src/hooks/useConnectionMode.js, useAuth.js, useApi.js,
         useLocalWebSocket.js, useCloudWebSocket.js, useRealtimeData.js
src/utils/constants.js, helpers.js
src/components/ (11ê°œ)
src/pages/Login.jsx, FarmSelector.jsx
src/pages/farm/ (6ê°œ)
src/pages/admin/ (5ê°œ)
```

### ê³µìœ /ë°°í¬/ë¬¸ì„œ (15ê°œ)
```
shared/constants.js, mqttTopics.js
node-red/flows.json, settings.js
docker/docker-compose.yml, Dockerfile.cloud, Dockerfile.frontend, nginx.conf, .env.example
scripts/setup-rpi.sh, deploy-rpi.sh, ecosystem.config.js
docs/aws-iot-setup.md, project-guide.md
.gitignore
```

---

## ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½

| ì˜ì—­ | ê¸°ìˆ  | ìš©ë„ |
|------|------|------|
| ë°±ì—”ë“œ ëŸ°íƒ€ì„ | Node.js 20 | ì„œë²„ ì‹¤í–‰ í™˜ê²½ |
| ë°±ì—”ë“œ í”„ë ˆì„ì›Œí¬ | Express.js | REST API + ë¯¸ë“¤ì›¨ì–´ |
| í´ë¼ìš°ë“œ DB | PostgreSQL 15 + Sequelize ORM | ì¤‘ì•™ ë°ì´í„° ì €ì¥ |
| ë¡œì»¬ DB | SQLite + better-sqlite3 | ë†ì¥ í˜„ì¥ ë°ì´í„° ì €ì¥ |
| í”„ë¡ íŠ¸ì—”ë“œ | React 19 + Vite 7 | UI ë Œë”ë§ + ë¹Œë“œ |
| UI ë¼ì´ë¸ŒëŸ¬ë¦¬ | Material-UI (MUI) 7 | ì»´í¬ë„ŒíŠ¸ + í„°ì¹˜ ìµœì í™” |
| ìƒíƒœ ê´€ë¦¬ | Zustand | ì „ì—­ ìƒíƒœ (ì¸ì¦, ì‹œìŠ¤í…œ, ë†ì¥) |
| ì°¨íŠ¸ | Recharts | ì¼ì¼ ì§‘ê³„ ì‹œê°í™” |
| ì‹¤ì‹œê°„ í†µì‹  | WebSocket (ws) | ë¸Œë¼ìš°ì € â†” ì„œë²„ ì‹¤ì‹œê°„ ë°ì´í„° |
| IoT í†µì‹  | AWS IoT Core (MQTT) | ì„œë²„ â†” RPi ë©”ì‹œì§€ ì¤‘ê³„ |
| ì„¼ì„œ/ìë™í™” | Node-RED | ì„¼ì„œ ìˆ˜ì§‘ + ê´€ìˆ˜ ìë™ ì œì–´ |
| ì¸ì¦ | JWT + bcryptjs | ë¡œê·¸ì¸, API ì¸ì¦ |
| ë°°í¬ (ì„œë²„) | Docker + Nginx | ì‚¬ë¬´ì‹¤ ì„œë²„ ì»¨í…Œì´ë„ˆí™” |
| ë°°í¬ (RPi) | PM2 | í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ + ìë™ ì¬ì‹œì‘ |
